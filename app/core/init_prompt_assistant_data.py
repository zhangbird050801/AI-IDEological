"""
初始化提示词助手数据
"""

import asyncio
from app.models.ideological import PromptAssistantTemplate
from tortoise import Tortoise
from app.core.init_app import init_db


async def init_prompt_assistant_templates():
    """初始化提示词助手模板"""

    templates_data = [
        {
            "name": "软件工程思政案例生成",
            "description": "帮助教师生成软件工程课程思政教学案例，结合知识点融入思政元素",
            "template_type": "case_generation",
            "target_audience": "软件工程教师、课程思政教学工作者",
            "use_case_scenario": "当教师需要为软件工程课程的某个知识点设计思政教学案例时使用",
            "sample_prompts": [
                "请为《软件工程》课程生成一个思政教学案例，结合{{软件工程章节}}知识点，融入{{思政主题}}元素。",
                "帮我设计一个关于{{知识点}}的课程思政案例，体现{{思政价值观}}，适合{{学生年级}}学生。",
                "创建一个软件工程案例，主题是{{技术话题}}，要体现{{职业素养}}，包含实际应用场景。"
            ],
            "key_questions": [
                "涉及软件工程的哪个章节？（需求分析、系统设计、编码实现、软件测试等）",
                "要融入什么思政主题？（工匠精神、团队协作、创新精神、责任担当等）",
                "具体的知识点是什么？",
                "学生的年级和基础如何？",
                "希望案例的难度等级？（1-5级）",
                "需要包含哪些教学环节？（引入、讲解、讨论、实践等）",
                "有实际项目背景吗？"
            ],
            "best_practices": [
                "明确软件工程章节和具体知识点",
                "选择契合的思政主题",
                "提供真实或贴近实际的项目背景",
                "设计启发性的讨论问题",
                "包含关键知识点和思政元素的融合点",
                "考虑学生的认知水平和接受度"
            ],
            "common_variables": ["软件工程章节", "思政主题", "知识点", "难度等级", "学生年级", "项目背景"]
        },
        {
            "name": "讨论题设计助手",
            "description": "帮助教师设计软件工程课程的思政讨论题，引导学生深度思考",
            "template_type": "discussion_generation",
            "target_audience": "软件工程教师、教学设计人员",
            "use_case_scenario": "当教师需要为软件工程课程设计启发性的讨论问题，引导学生思考技术与价值观时使用",
            "sample_prompts": [
                "为{{软件工程章节}}设计3-5个讨论题，引导学生思考{{思政主题}}。",
                "围绕{{技术话题}}，设计能够激发学生思考{{职业道德}}的问题。",
                "针对{{实际案例}}，设计讨论题让学生从{{思政角度}}进行分析。"
            ],
            "key_questions": [
                "针对哪个软件工程章节或知识点？",
                "要体现什么思政主题？",
                "讨论的深度如何？（初步认识、深度思考、价值判断）",
                "是否基于具体案例？",
                "学生需要进行个人思考还是小组讨论？",
                "讨论题数量需求？",
                "是否需要提供参考答案或讨论要点？"
            ],
            "best_practices": [
                "问题要有开放性和启发性",
                "结合真实的软件工程场景",
                "引导学生关联理论与实践",
                "设置层层递进的思考维度",
                "避免简单的是非判断题",
                "鼓励多角度分析"
            ],
            "common_variables": ["软件工程章节", "思政主题", "讨论深度", "案例背景", "题目数量", "参考要点"]
        },
        {
            "name": "教学设计助手",
            "description": "帮助教师设计软件工程课程的教学活动和教学环节，融入思政教育",
            "template_type": "teaching_design",
            "target_audience": "软件工程教师、教学设计人员",
            "use_case_scenario": "当教师需要为软件工程课程设计完整的教学活动方案，包含思政元素时使用",
            "sample_prompts": [
                "为{{软件工程章节}}设计一个{{课时长度}}的教学活动，融入{{思政主题}}。",
                "设计一个关于{{知识点}}的教学环节，包含导入、讲解、互动、总结，体现{{思政价值}}。",
                "创建一个{{教学模式}}的教学方案，针对{{学习目标}}，融入{{思政教育}}。"
            ],
            "key_questions": [
                "针对哪个软件工程章节或主题？",
                "课时长度是多少？（45分钟、90分钟等）",
                "要融入什么思政主题？",
                "教学目标是什么？（知识、能力、价值观）",
                "采用什么教学模式？（讲授、案例、讨论、实验等）",
                "学生的基础如何？",
                "有什么教学资源可以利用？"
            ],
            "best_practices": [
                "明确教学目标（知识+思政）",
                "设计清晰的教学环节",
                "安排合适的互动活动",
                "自然融入思政元素",
                "考虑时间分配合理性",
                "包含评价和反馈环节"
            ],
            "common_variables": ["软件工程章节", "课时长度", "思政主题", "教学目标", "教学模式", "学生基础"]
        },
        {
            "name": "实践项目设计助手",
            "description": "帮助教师设计软件工程实践项目，融入思政教育和职业素养培养",
            "template_type": "project_design",
            "target_audience": "软件工程教师、实验课教师",
            "use_case_scenario": "当教师需要设计软件工程实践项目，培养学生技术能力和职业素养时使用",
            "sample_prompts": [
                "设计一个{{项目类型}}的实践项目，针对{{软件工程阶段}}，培养学生的{{职业素养}}。",
                "创建一个{{难度等级}}的实践任务，涉及{{技术要点}}，体现{{团队协作}}精神。",
                "为{{课程模块}}设计实践项目，要求学生完成{{具体任务}}，强调{{质量意识}}。"
            ],
            "key_questions": [
                "项目针对哪个软件工程阶段？（需求、设计、编码、测试等）",
                "项目的难度等级？",
                "要培养哪些技能和素养？",
                "是个人项目还是团队项目？",
                "项目周期多长？",
                "有哪些技术要求？",
                "如何评价项目成果？"
            ],
            "best_practices": [
                "项目目标明确具体",
                "难度适中可完成",
                "包含思政教育元素",
                "强调团队协作和职业道德",
                "设计清晰的评价标准",
                "提供必要的指导和支持"
            ],
            "common_variables": ["项目类型", "软件工程阶段", "难度等级", "职业素养", "技术要点", "评价标准"]
        },
        {
            "name": "知识点讲解助手",
            "description": "帮助教师设计软件工程知识点的讲解内容，融入思政元素",
            "template_type": "knowledge_explanation",
            "target_audience": "软件工程教师",
            "use_case_scenario": "当教师需要设计某个软件工程知识点的讲解内容，并自然融入思政教育时使用",
            "sample_prompts": [
                "为{{知识点}}设计讲解内容，深入浅出地说明原理，并联系{{思政主题}}。",
                "创建关于{{技术概念}}的教学讲解，包含原理、案例和{{价值观引导}}。",
                "设计{{软件工程原理}}的讲解方案，结合实际应用，体现{{职业精神}}。"
            ],
            "key_questions": [
                "要讲解的知识点是什么？",
                "学生的先修知识基础如何？",
                "讲解的深度要求？（概念理解、深入原理、实践应用）",
                "要融入什么思政元素？",
                "有实际案例支撑吗？",
                "如何检验学生理解程度？",
                "讲解时长控制？"
            ],
            "best_practices": [
                "从学生已知到未知循序渐进",
                "使用生动的类比和例子",
                "结合实际项目案例",
                "自然引入思政元素",
                "设计互动和提问环节",
                "提供延伸学习资源"
            ],
            "common_variables": ["知识点", "技术概念", "思政主题", "讲解深度", "实际案例", "互动设计"]
        },
        {
            "name": "课程评价设计助手",
            "description": "帮助教师设计软件工程课程的评价方案，包括思政教育效果评价",
            "template_type": "evaluation_design",
            "target_audience": "软件工程教师、教学管理人员",
            "use_case_scenario": "当教师需要设计课程评价方案，评估学生的技术能力和思政素养时使用",
            "sample_prompts": [
                "为{{课程模块}}设计评价方案，评估学生的{{技术能力}}和{{思政素养}}。",
                "创建{{评价类型}}的评价标准，包含{{知识点考核}}和{{价值观评价}}。",
                "设计一个全面的课程评价体系，涵盖{{评价维度}}，体现{{思政目标}}达成度。"
            ],
            "key_questions": [
                "评价的课程模块是什么？",
                "评价类型？（过程性评价、总结性评价、诊断性评价）",
                "要评价哪些维度？（知识、能力、素养）",
                "如何评价思政教育效果？",
                "采用什么评价方式？（考试、项目、作业、表现等）",
                "评价标准如何制定？",
                "如何确保评价的公平性和有效性？"
            ],
            "best_practices": [
                "评价目标清晰具体",
                "评价标准客观可操作",
                "兼顾知识技能和思政素养",
                "采用多元化评价方式",
                "重视过程性评价",
                "提供明确的评分细则和反馈机制"
            ],
            "common_variables": ["课程模块", "评价类型", "评价维度", "思政目标", "评价方式", "评分标准"]
        }
    ]

    # 检查是否已存在模板
    existing_count = await PromptAssistantTemplate.filter().count()

    if existing_count > 0:
        print(f"提示词助手模板已存在 ({existing_count} 个)，删除旧模板...")
        await PromptAssistantTemplate.all().delete()
        print("旧模板已删除")

    # 创建模板
    created_count = 0
    for template_data in templates_data:
        try:
            await PromptAssistantTemplate.create(**template_data)
            created_count += 1
            print(f"已创建提示词助手模板: {template_data['name']}")
        except Exception as e:
            print(f"创建模板失败 {template_data['name']}: {str(e)}")

    print(f"\n提示词助手模板初始化完成，共创建 {created_count} 个模板")


async def main():
    """主函数"""
    # 初始化数据库连接
    await init_db()

    try:
        # 初始化提示词助手模板
        await init_prompt_assistant_templates()
        print("\n✅ 提示词助手数据初始化成功完成!")
    except Exception as e:
        print(f"\n❌ 提示词助手数据初始化失败: {str(e)}")
        raise
    finally:
        # 关闭数据库连接
        await Tortoise.close_connections()


if __name__ == "__main__":
    asyncio.run(main())